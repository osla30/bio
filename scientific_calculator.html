<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scientific Calculator</title>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 10px auto;
      background: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
      font-size: 14px;
    }
    
    h1 {
      text-align: center;
      color: #2563eb;
      font-size: 1.8em;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    h2 { 
      display: flex; 
      align-items: center;
      font-size: 1.2em;
      margin-bottom: 15px;
    }
    
    #download-btn {
      font-size: 12px;
      padding: 4px 12px;
      border-radius: 5px;
      border: 1px solid #888;
      background: #f0f0f0;
      cursor: pointer;
      text-decoration: none;
      color: #222;
      transition: background 0.2s;
      white-space: nowrap;
    }
    
    #download-btn:hover {
      background: #e0e0e0;
    }
    
    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 5px;
    }
    
    .tab {
      padding: 8px 12px;
      border-radius: 4px;
      background: #ccc;
      color: #000;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
      font-size: 13px;
      text-align: center;
      min-width: 80px;
    }
    
    .tab.active {
      background: #2563eb;
      color: white;
    }
    
    /* 表單布局 */
    .form-container {
      display: grid;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .form-row {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .form-row-inline {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    label {
      font-weight: bold;
      color: #333;
      min-width: 120px;
    }
    
    input, select {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      width: 100%;
      max-width: 200px;
    }
    
    .input-group {
      display: flex;
      gap: 5px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .input-group input {
      flex: 1;
      min-width: 100px;
    }
    
    .input-group select {
      min-width: 80px;
      flex-shrink: 0;
    }
    
    button {
      padding: 10px 16px;
      margin: 5px 5px 5px 0;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      background: #2563eb;
      color: white;
      font-weight: bold;
      font-size: 14px;
      transition: background 0.2s;
    }
    
    button:hover {
      background: #1d4ed8;
    }
    
    button.clear {
      background: #6b7280;
    }
    
    button.clear:hover {
      background: #4b5563;
    }
    
    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 15px;
    }
    
    .result {
      margin-top: 15px;
      padding: 15px;
      background: #fff;
      border-radius: 6px;
      border-left: 4px solid #2563eb;
      font-weight: bold;
      color: #2563eb;
      white-space: pre-wrap;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .note {
      font-size: 0.85em;
      color: #dc2626;
      margin: 10px 0;
      padding: 10px;
      background: #fef2f2;
      border-radius: 4px;
      border-left: 3px solid #dc2626;
    }
    
    /* Primer和細胞計數的flex容器 */
    .flex-container {
      display: grid;
      gap: 20px;
      margin: 15px 0;
    }
    
    .flex-block {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* 計時器樣式 */
    .timer-flex-container {
      display: grid;
      gap: 20px;
      margin: 15px 0;
    }
    
    .timer-block {
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .timer-title {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
      font-weight: bold;
      font-size: 1em;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .time-inputs {
      display: flex;
      gap: 5px;
      margin-bottom: 10px;
      justify-content: center;
    }
    
    .time-inputs input {
      width: 70px;
      padding: 8px;
      text-align: center;
    }
    
    .timer-display {
      font-size: 1.8em;
      text-align: center;
      margin: 15px 0;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      color: #2563eb;
      background: #f8fafc;
      padding: 15px;
      border-radius: 6px;
      border: 2px solid #e2e8f0;
    }
    
    .timer-controls {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .timer-controls button {
      flex: 1;
      min-width: 70px;
    }
    
    .timer-section-title {
      margin: 20px 0 15px 0;
      font-size: 1.3em;
      color: #2563eb;
      text-align: center;
      font-weight: bold;
    }
    
    /* 響應式設計 */
    @media (min-width: 640px) {
      body {
        padding: 20px;
        font-size: 15px;
      }
      
      h1 {
        font-size: 2.2em;
      }
      
      .form-row-inline {
        flex-direction: row;
        align-items: center;
      }
      
      .form-row-inline label {
        min-width: 140px;
        margin-bottom: 0;
      }
      
      input, select {
        width: auto;
      }
      
      .flex-container {
        grid-template-columns: 1fr 1fr;
      }
      
      .timer-flex-container {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    @media (min-width: 768px) {
      .tabs {
        gap: 8px;
      }
      
      .tab {
        padding: 10px 16px;
        font-size: 14px;
        min-width: 100px;
      }
      
      .timer-display {
        font-size: 2.2em;
      }
    }
    
    @media (min-width: 1024px) {
      body {
        padding: 30px;
      }
      
      .form-container {
        max-width: 600px;
      }
    }
    
    /* 動物投藥特殊樣式 */
    .animal-dose-group {
      margin: 15px 0;
      padding: 15px;
      background: #f8fafc;
      border-radius: 6px;
      border: 1px solid #e2e8f0;
    }
    
    .animal-dose-group label {
      display: block;
      margin-bottom: 8px;
    }
    
    .indent {
      margin-left: 20px;
    }
    
    /* 手機版優化 */
    @media (max-width: 639px) {
      .tabs {
        justify-content: flex-start;
        overflow-x: auto;
        padding-bottom: 5px;
      }
      
      .tab {
        flex-shrink: 0;
        min-width: 90px;
        font-size: 12px;
        padding: 6px 10px;
      }
      
      .time-inputs input {
        width: 60px;
        padding: 6px;
      }
      
      .timer-display {
        font-size: 1.5em;
        padding: 10px;
      }
      
      .timer-controls button {
        min-width: 60px;
        padding: 8px 12px;
        font-size: 13px;
      }
      
      h1 {
        font-size: 1.5em;
        flex-direction: column;
        gap: 8px;
      }
      
      #download-btn {
        font-size: 11px;
        padding: 3px 8px;
      }
    }
  </style>
</head>
<body>
  <h1>Scientific Calculator
    <a id="download-btn" href="https://drive.google.com/file/d/1XZXuOxtin_b-Psg7c6mRKox81ZiWvU8g/view?usp=sharing" target="_blank" rel="noopener noreferrer">Download Offline Version</a>
  </h1>

  <div class="tabs">
    <div class="tab active" id="tab-mass" onclick="switchTab('mass')">Mass Calculation</div>
    <div class="tab" id="tab-dilution" onclick="switchTab('dilution')">Dilution Calculation</div>
    <div class="tab" id="tab-acidbase" onclick="switchTab('acidbase')">Acid-Base Molarity</div>
    <div class="tab" id="tab-animal" onclick="switchTab('animal')">Animal Drug Dosage Calculation</div>
    <div class="tab" id="tab-animal2" onclick="switchTab('animal2')">Animal Drug Dosage Calculation2</div>
    <div class="tab" id="tab-primer" onclick="switchTab('primer')">Primer Reconstitution/Dilution</div>
    <div class="tab" id="tab-cellcount" onclick="switchTab('cellcount')">Cell Count</div>
    <div class="tab" id="tab-timer" onclick="switchTab('timer')">Timer</div>
  </div>

  <!-- 質量計算 -->
  <div id="mass" class="tab-content">
  <div class="form-container">
    <div class="form-row-inline">
      <label for="molarMass">Molecular weight (g/mol)：</label>
      <input type="number" id="molarMass" step="any" />
    </div>

    <div class="form-row-inline">
      <label for="molarity">Molarity：</label>
      <div class="input-group">
        <input type="number" id="molarity" step="any" />
        <select id="molarityUnit">
          <option value="1">M</option>
          <option value="0.001">mM</option>
          <option value="0.000001">μM</option>
          <option value="0.000000001">nM</option>
          <option value="0.000000000001">pM</option>
          <option value="0.000000000000001">fM</option>
        </select>
      </div>
    </div>

    <div class="form-row-inline">
      <label for="volume">Volume：</label>
      <div class="input-group">
        <input type="number" id="volume" step="any" />
        <select id="volumeUnit">
          <option value="1">L</option>
          <option value="0.001">mL</option>
          <option value="0.000001">μL</option>
          <option value="0.000000001">nL</option>
          <option value="0.000000000001">pL</option>
          <option value="0.000000000000001">fL</option>
        </select>
      </div>
    </div>

    <div class="form-row-inline">
      <label for="massValue">Mass：</label>
      <div class="input-group">
        <input type="number" id="massValue" step="any" />
        <select id="massUnit">
          <option value="1">g</option>
          <option value="1000">kg</option>
          <option value="0.001">mg</option>
          <option value="0.000001">μg</option>
          <option value="0.000000001">ng</option>
          <option value="0.000000000001">pg</option>
          <option value="0.000000000000001">fg</option>
        </select>
      </div>
    </div>
  </div>

  <div class="note">Please enter the [Molecular weight] and any two of the following: [Molarity, Volume, or Mass]. The remaining value will be calculated automatically.</div>

  <div class="button-group">
    <button onclick="calculateMass()">計算</button>
    <button class="clear" onclick="clearMass()">清除</button>
  </div>

  <div id="massResult" class="result" style="display:none;"></div>
</div>

  <!-- 稀釋計算 -->
  <div id="dilution" class="tab-content" style="display:none;">
    <div class="form-container">
      <div class="form-row-inline">
        <label for="c1">Stock Concentration C₁：</label>
        <div class="input-group">
          <input type="number" id="c1" step="any" />
          <select id="c1Unit">
            <option value="1">M</option>
            <option value="0.001">mM</option>
            <option value="0.000001">μM</option>
            <option value="0.000000001">nM</option>
            <option value="0.000000000001">pM</option>
            <option value="0.000000000000001">fM</option>
          </select>
        </div>
      </div>

      <div class="form-row-inline">
        <label for="c2">Target Concentration C₂：</label>
        <div class="input-group">
          <input type="number" id="c2" step="any" />
          <select id="c2Unit">
            <option value="1">M</option>
            <option value="0.001">mM</option>
            <option value="0.000001">μM</option>
            <option value="0.000000001">nM</option>
            <option value="0.000000000001">pM</option>
            <option value="0.000000000000001">fM</option>
          </select>
        </div>
      </div>

      <div class="form-row-inline">
        <label for="v2">Target Volume V₂：</label>
        <div class="input-group">
          <input type="number" id="v2" step="any" />
          <select id="v2Unit">
            <option value="1">L</option>
            <option value="0.001">mL</option>
            <option value="0.000001">μL</option>
            <option value="0.000000001">nL</option>
            <option value="0.000000000001">pL</option>
            <option value="0.000000000000001">fL</option>
          </select>
        </div>
      </div>

      <div class="form-row-inline">
        <label for="v1">Stock Volume V₁：</label>
        <div class="input-group">
          <input type="number" id="v1" step="any" />
          <select id="v1Unit">
            <option value="1">L</option>
            <option value="0.001">mL</option>
            <option value="0.000001">μL</option>
            <option value="0.000000001">nL</option>
            <option value="0.000000000001">pL</option>
            <option value="0.000000000000001">fL</option>
          </select>
        </div>
      </div>
    </div>

    <div class="note">Please enter any three values to calculate the fourth value.</div>

    <div class="button-group">
      <button onclick="calculateDilution()">Calculate Missing Value</button>
      <button class="clear" onclick="clearDilution()">Clear</button>
    </div>

    <div id="dilutionResult" class="result" style="display:none;"></div>
  </div>

  <!-- 酸鹼莫耳濃度 -->
  <div id="acidbase" class="tab-content" style="display:none;">
    <div class="form-container">
      <div class="form-row-inline">
        <label for="acidBaseMW">Molecular Weight (g/mol)：</label>
        <input type="number" id="acidBaseMW" step="any" />
      </div>

      <div class="form-row-inline">
        <label for="density">Density：</label>
        <div class="input-group">
          <input type="number" id="density" step="any" />
          <select id="densityUnit">
            <option value="1">g/mL</option>
            <option value="1">g/cm³</option>
            <option value="1">kg/L</option>
            <option value="0.001">g/L</option>
          </select>
        </div>
      </div>

      <div class="form-row-inline">
        <label for="weightPercent">Weight Percentage (%)：</label>
        <input type="number" id="weightPercent" step="any" />
      </div>
      
      <div class="form-row-inline">
        <label for="acidBaseMolarity">Molarity：</label>
        <div class="input-group">
          <input type="number" id="acidBaseMolarity" step="any" />
          <select id="acidBaseMolarityUnit">
            <option value="1">M</option>
            <option value="0.001">mM</option>
            <option value="0.000001">μM</option>
            <option value="0.000000001">nM</option>
            <option value="0.000000000001">pM</option>
            <option value="0.000000000000001">fM</option>
          </select>
        </div>
      </div>
    </div>

    <div class="note">Sulfuric acid (H₂SO₄) → Two H⁺ ions → 1M = 2N<br>
    Phosphoric acid (H₃PO₄) → Three H⁺ ions → 1M = 3N</div>
    <div class="note">Please enter the [Molecular weight and Density], along with either the [Weight percentage or Molarity]. The remaining value will be calculated automatically.</div>

    <div class="button-group">
      <button onclick="calculateAcidBase()">Calculate</button>
      <button class="clear" onclick="clearAcidBase()">Clear</button>
    </div>

    <div id="acidBaseResult" class="result" style="display:none;"></div>
  </div>

  <!-- 動物投藥計算 -->
  <div id="animal" class="tab-content" style="display:none;">
    <div class="form-container">
      <div class="form-row-inline">
        <label for="targetDose">Target Drug Dosage (mg/Kg)：</label>
        <input type="number" id="targetDose" step="any" />
      </div>

      <div class="animal-dose-group">
        <label>Preferred Administration Method：</label>
        <div class="form-row-inline indent">
          <label>(g)：</label>
          <input type="number" id="doseB1" step="any" style="max-width: 150px;" />
        </div>
        <div class="form-row-inline indent">
          <label>(mL)：</label>
          <input type="number" id="doseB2" step="any" style="max-width: 150px;" />
        </div>
        <div class="note">For example: Enter 10, 0.1 ➜ Administer 0.1mL per 10g<br>Then for an animal weighing 27g, administer 0.27mL.</div>
      </div>

      <div class="form-row-inline">
        <label for="animalWeight">Estimated Weight Per Animal (g)：</label>
        <input type="number" id="animalWeight" step="any" />
      </div>

      <div class="form-row-inline">
        <label for="animalCount">Estimated Number of Animals (pc)：</label>
        <input type="number" id="animalCount" step="any" />
      </div>
    </div>

    <div class="button-group">
      <button onclick="calculateAnimalDose()">Calculate</button>
      <button class="clear" onclick="clearAnimal()">Clear</button>
    </div>

    <div id="animalResult" class="result" style="display:none;"></div>
  </div>

  <!-- 動物投藥計算2 -->
  <div id="animal2" class="tab-content" style="display:none;">
    <div class="form-container">
      <div class="form-row-inline">
        <label for="targetDose2">Target Drug Dosage (mg/Kg)：</label>
        <input type="number" id="targetDose2" step="any" />
      </div>

      <div class="form-row-inline">
        <label for="drugConc2">Drug Concentration Used：</label>
        <div class="input-group">
          <input type="number" id="drugConc2" step="any" />
          <select id="drugConc2Unit">
            <option value="mgml">mg/mL</option>
            <option value="percent">%</option>
          </select>
        </div>
      </div>

      <div class="form-row-inline">
        <label for="animalWeight2">Animal Weight (g)：</label>
        <input type="number" id="animalWeight2" step="any" />
      </div>
    </div>

    <div class="button-group">
      <button onclick="calculateAnimalDose2()">Calculate</button>
      <button class="clear" onclick="clearAnimal2()">Clear</button>
    </div>

    <div id="animalResult2" class="result" style="display:none;"></div>
  </div> 

  <!-- Primer回溶/稀釋 -->
  <div id="primer" class="tab-content" style="display:none;">
    <div class="flex-container">
      <div class="flex-block">
        <h2>Primer Reconstitution</h2>
        <div class="note">(General primer yield X nmole, reconstitute with X*10 µL water gives 100 µM)</div>
        <div class="form-container">
          <div class="form-row-inline">
            <label>Primer Yield (nmole)：</label>
            <input type="number" id="primerAmount" step="any">
          </div>
          <div class="form-row-inline">
            <label>Reconstitution Volume (µL)：</label>
            <input type="number" id="primerVolume" step="any">
          </div>
          <div class="form-row-inline">
            <label>Concentration After Reconstitution (µM)：</label>
            <input type="number" id="primerConc" step="any">
          </div>
        </div>
        <div class="note">Please enter any two values to calculate the third value.</div>
        <div class="button-group">
          <button onclick="calcPrimer()">Calculate</button>
          <button class="clear" onclick="clearPrimer()">Clear</button>
        </div>
        <div id="primerResult" class="result" style="display:none;"></div>
      </div>
      
      <div class="flex-block">
        <h2>Primer Dilution</h2>
        <div class="form-container">
          <div class="form-row-inline">
            <label>Stock Concentration (µM)：</label>
            <input type="number" id="stockConc" step="any">
          </div>
          <div class="form-row-inline">
            <label>Target Concentration (µM)：</label>
            <input type="number" id="targetConc" step="any">
          </div>
          <div class="form-row-inline">
            <label>Target Volume (µL)：</label>
            <input type="number" id="targetVol" step="any">
          </div>
        </div>
        <div class="button-group">
          <button onclick="calcDilute()">Calculate</button>
          <button class="clear" onclick="clearDilute()">Clear</button>
        </div>
        <div id="diluteResult" class="result" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- 細胞計數 -->
  <div id="cellcount" class="tab-content" style="display:none;">
    <div class="flex-container">
      <div class="flex-block">
        <h2>White Blood Cell (Cell) Count</h2>
        <div class="note">(Usually use large squares at the four corners)</div>
        <div class="form-container">
          <div class="form-row-inline">
            <label>Cell Count：</label>
            <input type="number" id="wbcCount" step="any">
          </div>
          <div class="form-row-inline">
            <label>Number of Squares：</label>
            <input type="number" id="wbcSquares" step="any">
          </div>
          <div class="form-row-inline">
            <label>Dilution Factor：</label>
            <input type="number" id="wbcDilution" step="any">
          </div>
          <div class="form-row-inline">
            <label>Unit Display：</label>
            <select id="wbcUnit" onchange="updateWBCResult()">
              <option value="1">cells/µL</option>
              <option value="1000">cells/mL</option>
            </select>
          </div>
        </div>
        <div class="button-group">
          <button onclick="calculateWBC()">Calculate</button>
          <button class="clear" onclick="clearWBC()">Clear</button>
        </div>
        <div id="wbcResult" class="result" style="display:none;"></div>
      </div>
      
      <div class="flex-block">
        <h2>Red Blood Cell Count</h2>
        <div class="note">(Usually use 25 medium squares and select 5 non-overlapping squares)</div>
        <div class="form-container">
          <div class="form-row-inline">
            <label>Cell Count：</label>
            <input type="number" id="rbcCount" step="any">
          </div>
          <div class="form-row-inline">
            <label>Number of Squares：</label>
            <input type="number" id="rbcSquares" step="any">
          </div>
          <div class="form-row-inline">
            <label>Dilution Factor：</label>
            <input type="number" id="rbcDilution" step="any">
          </div>
          <div class="form-row-inline">
            <label>Unit Display：</label>
            <select id="rbcUnit" onchange="updateRBCResult()">
              <option value="1">cells/µL</option>
              <option value="1000">cells/mL</option>
            </select>
          </div>
        </div>
        <div class="button-group">
          <button onclick="calculateRBC()">Calculate</button>
          <button class="clear" onclick="clearRBC()">Clear</button>
        </div>
        <div id="rbcResult" class="result" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- 計時器分頁 -->
  <div id="timer" class="tab-content" style="display:none;">
    <div class="timer-flex-container">
      <div style="flex: 1;">
        <div class="timer-section-title">Countdown Timer (Offline version will sound an alarm)</div>
        <div class="timer-block" id="countdown1">
          <input type="text" class="timer-title" placeholder="Timer 1" onchange="updateTimerTitle('countdown', 0, this.value)">
          <div class="time-inputs">
            <input type="number" min="0" placeholder="HH" id="cd-hours1">
            <input type="number" min="0" placeholder="MM" id="cd-minutes1">
            <input type="number" min="0" placeholder="SS" id="cd-seconds1">
          </div>
          <div class="timer-display" id="cd-display1">00:00:00</div>
          <div class="timer-controls">
            <button onclick="startCountdown(0)">Start</button>
            <button onclick="pauseCountdown(0)">Pause</button>
            <button onclick="resetCountdown(0)">Reset</button>
          </div>
        </div>
        <div class="timer-block" id="countdown2">
          <input type="text" class="timer-title" placeholder="Timer 2" onchange="updateTimerTitle('countdown', 1, this.value)">
          <div class="time-inputs">
            <input type="number" min="0" placeholder="HH" id="cd-hours2">
            <input type="number" min="0" placeholder="MM" id="cd-minutes2">
            <input type="number" min="0" placeholder="SS" id="cd-seconds2">
          </div>
          <div class="timer-display" id="cd-display2">00:00:00</div>
          <div class="timer-controls">
            <button onclick="startCountdown(1)">Start</button>
            <button onclick="pauseCountdown(1)">Pause</button>
            <button onclick="resetCountdown(1)">Reset</button>
          </div>
        </div>
      </div>
      
      <div style="flex: 1;">
        <div class="timer-section-title">Stopwatch</div>
        <div class="timer-block" id="stopwatch1">
          <input type="text" class="timer-title" placeholder="Stopwatch 1" onchange="updateTimerTitle('stopwatch', 0, this.value)">
          <div class="timer-display" id="sw-display1">00:00:00.0</div>
          <div class="timer-controls">
            <button onclick="startStopwatch(0)">Start</button>
            <button onclick="pauseStopwatch(0)">Pause</button>
            <button onclick="resetStopwatch(0)">Reset</button>
          </div>
        </div>
        <div class="timer-block" id="stopwatch2">
          <input type="text" class="timer-title" placeholder="Stopwatch 2" onchange="updateTimerTitle('stopwatch', 1, this.value)">
          <div class="timer-display" id="sw-display2">00:00:00.0</div>
          <div class="timer-controls">
            <button onclick="startStopwatch(1)">Start</button>
            <button onclick="pauseStopwatch(1)">Pause</button>
            <button onclick="resetStopwatch(1)">Reset</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<audio id="timer-audio" src="sounds/timer.mp3" preload="auto"></audio>

<script>
  let audioLoopInterval = null;
  let audioTimeout = null;
  
  function switchTab(tab) {
    const tabs = ['mass', 'dilution', 'acidbase', 'animal', 'animal2', 'primer', 'cellcount', 'timer'];
    tabs.forEach(t => {
      document.getElementById(t).style.display = (t === tab) ? 'block' : 'none';
      document.getElementById('tab-' + t).classList.toggle('active', t === tab);
    });
  }

  // 顯示/隱藏結果區域的輔助函數
  function showResult(id, text) {
    const element = document.getElementById(id);
    element.textContent = text;
    element.style.display = 'block';
  }

  function hideResult(id) {
    const element = document.getElementById(id);
    element.style.display = 'none';
    element.textContent = '';
  }

  // 質量計算
  function calculateMass() {
  const molarMass = parseFloat(document.getElementById('molarMass').value);
  const molarity = parseFloat(document.getElementById('molarity').value);
  const molarityUnit = parseFloat(document.getElementById('molarityUnit').value);
  const volume = parseFloat(document.getElementById('volume').value);
  const volumeUnit = parseFloat(document.getElementById('volumeUnit').value);
  const massValue = parseFloat(document.getElementById('massValue').value);
  const massUnit = parseFloat(document.getElementById('massUnit').value);

  if (isNaN(molarMass) || molarMass <= 0) {
    alert('Please enter the Molecular weight');
    return;
  }

  let filledCount = 0;
  if (!isNaN(molarity)) filledCount++;
  if (!isNaN(volume)) filledCount++;
  if (!isNaN(massValue)) filledCount++;

  if (filledCount < 2) {
    alert('Please enter at least any two of Molarity, Volume, or Mass');
    return;
  }

  let resultText = '';

  if (isNaN(molarity)) {
    // 計算 molarity = mass / (MW * volume)
    const molarityM = (massValue * massUnit) / (molarMass * volume * volumeUnit);
    const molarityConverted = molarityM / molarityUnit;
    document.getElementById('molarity').value = molarityConverted.toFixed(6);
    resultText = `Calculate molarity：${molarityConverted.toFixed(6)} ${getSelectedText('molarityUnit')}`;
  } else if (isNaN(volume)) {
    // 計算 volume = mass / (MW * molarity)
    const volumeL = (massValue * massUnit) / (molarMass * molarity * molarityUnit);
    const volumeConverted = volumeL / volumeUnit;
    document.getElementById('volume').value = volumeConverted.toFixed(6);
    resultText = `Calculate volume：${volumeConverted.toFixed(6)} ${getSelectedText('volumeUnit')}`;
  } else if (isNaN(massValue)) {
    // 計算 mass = molarity * volume * MW
    const massG = (molarity * molarityUnit) * (volume * volumeUnit) * molarMass;
    const massConverted = massG / massUnit;
    document.getElementById('massValue').value = massConverted.toFixed(6);
    resultText = `Calculate mass：${massConverted.toFixed(6)} ${getSelectedText('massUnit')}`;
  } else {
    resultText = 'Please clear one field of Molarity, Volume, or Mass to calculate its value';
  }

  showResult('massResult', resultText);
}

function clearMass() {
  ['molarity', 'volume', 'massValue', 'molarMass'].forEach(id => document.getElementById(id).value = '');
  hideResult('massResult');
}

  // 稀釋計算
  function calculateDilution() {
    const c1 = parseFloat(document.getElementById('c1').value);
    const c1Unit = parseFloat(document.getElementById('c1Unit').value);
    const v1 = parseFloat(document.getElementById('v1').value);
    const v1Unit = parseFloat(document.getElementById('v1Unit').value);
    const c2 = parseFloat(document.getElementById('c2').value);
    const c2Unit = parseFloat(document.getElementById('c2Unit').value);
    const v2 = parseFloat(document.getElementById('v2').value);
    const v2Unit = parseFloat(document.getElementById('v2Unit').value);

    let filledCount = 0;
    [c1, v1, c2, v2].forEach(v => { if (!isNaN(v)) filledCount++; });

    if (filledCount < 3) {
      alert('Please enter any three values');
      return;
    }

    try {
      if (isNaN(c1)) {
        const val = (c2 * c2Unit) * (v2 * v2Unit) / (v1 * v1Unit);
        const result = val / c1Unit;
        document.getElementById('c1').value = result.toFixed(6);
        showResult('dilutionResult', `Calculate the concentration of the stock solution C₁ = ${result.toFixed(6)} ${getSelectedText('c1Unit')}`);
      } else if (isNaN(v1)) {
        const val = (c2 * c2Unit) * (v2 * v2Unit) / (c1 * c1Unit);
        const result = val / v1Unit;
        document.getElementById('v1').value = result.toFixed(6);
        showResult('dilutionResult', `Calculate the volume of the stock solution V₁ = ${result.toFixed(6)} ${getSelectedText('v1Unit')}`);
      } else if (isNaN(c2)) {
        const val = (c1 * c1Unit) * (v1 * v1Unit) / (v2 * v2Unit);
        const result = val / c2Unit;
        document.getElementById('c2').value = result.toFixed(6);
        showResult('dilutionResult', `Calculate the target concentration C₂ = ${result.toFixed(6)} ${getSelectedText('c2Unit')}`);
      } else if (isNaN(v2)) {
        const val = (c1 * c1Unit) * (v1 * v1Unit) / (c2 * c2Unit);
        const result = val / v2Unit;
        document.getElementById('v2').value = result.toFixed(6);
        showResult('dilutionResult', `Calculate the target volume V₂ = ${result.toFixed(6)} ${getSelectedText('v2Unit')}`);
      } else {
        showResult('dilutionResult', 'Please clear a field to calculate the value');
      }
    } catch {
      showResult('dilutionResult', 'Calculation error, please check your input');
    }
  }

  function clearDilution() {
    ['c1', 'v1', 'c2', 'v2'].forEach(id => document.getElementById(id).value = '');
    hideResult('dilutionResult');
  }

  // 酸鹼莫耳濃度雙向計算
  function calculateAcidBase() {
    const weightPercentInput = document.getElementById('weightPercent');
    const molarityInput = document.getElementById('acidBaseMolarity');
    const densityInput = document.getElementById('density');
    const densityUnitSelect = document.getElementById('densityUnit');
    const molarMassInput = document.getElementById('acidBaseMW');
    const molarityUnitSelect = document.getElementById('acidBaseMolarityUnit');
    
    const weightPercent = parseFloat(weightPercentInput.value);
    const molarity = parseFloat(molarityInput.value);
    const density = parseFloat(densityInput.value);
    const densityUnit = parseFloat(densityUnitSelect.value);
    const molarMass = parseFloat(molarMassInput.value);
    const molarityUnit = parseFloat(molarityUnitSelect.value);

    if (isNaN(density) || isNaN(molarMass)) {
      alert('Please enter molecular weight and density');
      return;
    }

    const densityStd = density * densityUnit;

    if (!isNaN(weightPercent) && isNaN(molarity)) {
      // 計算莫耳濃度 M = (重量百分比 * 密度) / 分子量 * 10
      const molarityM = ((weightPercent * densityStd) / molarMass) * 10;
      const molarityConverted = molarityM / molarityUnit;
      molarityInput.value = molarityConverted.toFixed(6);
      showResult('acidBaseResult', `Calculate molarity：${molarityConverted.toFixed(6)} ${molarityUnitSelect.options[molarityUnitSelect.selectedIndex].text}`);
    } else if (isNaN(weightPercent) && !isNaN(molarity)) {
      // 計算重量百分比 = (莫耳濃度 * 分子量) / (密度 * 10)
      const molarityM = molarity * molarityUnit;
      const weightPercentCalc = (molarityM * molarMass) / (densityStd * 10);
      weightPercentInput.value = weightPercentCalc.toFixed(6);
      showResult('acidBaseResult', `Calculate weight percentage：${weightPercentCalc.toFixed(6)} %`);
    } else {
      alert('Please enter either weight percentage or molarity, leave the other blank');
    }
  }

  function clearAcidBase() {
    ['weightPercent', 'acidBaseMolarity', 'density', 'acidBaseMW'].forEach(id => document.getElementById(id).value = '');
    hideResult('acidBaseResult');
  }

  // 動物投藥計算
  function calculateAnimalDose() {
    const targetDose = parseFloat(document.getElementById('targetDose').value); // mg/Kg
    const doseB1 = parseFloat(document.getElementById('doseB1').value); // g
    const doseB2 = parseFloat(document.getElementById('doseB2').value); // mL
    const animalWeight = parseFloat(document.getElementById('animalWeight').value); // g
    const animalCount = parseFloat(document.getElementById('animalCount').value); // pc

    if ([targetDose, doseB1, doseB2, animalWeight, animalCount].some(v => isNaN(v) || v <= 0)) {
      alert('Please enter all fields and the values must be greater than 0');
      return;
    }

    // 每隻動物投藥量 (mg/pc) = (A/1000)*C
    const dosePerAnimal = (targetDose / 1000) * animalWeight;

    // 配製藥物濃度(mg/mL)
    const concentration = (targetDose / (1000 / doseB1)) / doseB2;

    // 配製藥物總重量 (mg)
    const totalWeight = (targetDose / (1000 / doseB1)) * ((doseB2 * animalCount * (animalWeight / doseB1)) / doseB2);

    // 配製藥物溶液總體積 (mL)
    const totalVolume = doseB2 * animalCount * (animalWeight / doseB1);

    const resultText =
      `Dosage per animal：${dosePerAnimal.toFixed(6)} mg/pc\n` +
      `Prepare drug concentration：${concentration.toFixed(6)} mg/mL\n` +
      `Total weight of prepared drugs：${totalWeight.toFixed(6)} mg\n` +
      `Total volume of prepared drug solution：${totalVolume.toFixed(6)} mL`;

    showResult('animalResult', resultText);
  }

  function clearAnimal() {
    ['targetDose', 'doseB1', 'doseB2', 'animalWeight', 'animalCount'].forEach(id => document.getElementById(id).value = '');
    hideResult('animalResult');
  }

  // 動物投藥計算2
  function calculateAnimalDose2() {
    const a = parseFloat(document.getElementById('targetDose2').value);
    const b = parseFloat(document.getElementById('drugConc2').value);
    const unit = document.getElementById('drugConc2Unit').value;
    const c = parseFloat(document.getElementById('animalWeight2').value);

    if (isNaN(a) || isNaN(b) || isNaN(c) || b === 0) {
      showResult('animalResult2', 'Please enter a valid value, and the drug concentration cannot be zero');
      return;
    }

    // 計算投藥量 d = ((a/1000)*c)/b
    let d = ((a / 1000) * c) / b;

    // 若選擇百分比單位，結果少10倍
    if (unit === "percent") {
      d = d / 10;
    }

    showResult('animalResult2', `Dosage：${d.toFixed(3)} mL`);
  }

  function clearAnimal2() {
    document.getElementById('targetDose2').value = '';
    document.getElementById('drugConc2').value = '';
    document.getElementById('animalWeight2').value = '';
    document.getElementById('drugConc2Unit').selectedIndex = 0;
    hideResult('animalResult2');
  }

  // Primer回溶雙向計算
  function calcPrimer() {
    let A = parseFloat(document.getElementById('primerAmount').value);
    let B = parseFloat(document.getElementById('primerVolume').value);
    let C = parseFloat(document.getElementById('primerConc').value);
    let count = 0;
    if (!isNaN(A)) count++;
    if (!isNaN(B)) count++;
    if (!isNaN(C)) count++;
    if (count < 2) {
      showResult('primerResult', 'Please enter any two fields');
      return;
    }
    if (!isNaN(A) && !isNaN(B)) {
      C = (A / B) * 1000;
      document.getElementById('primerConc').value = C.toFixed(2);
      showResult('primerResult', `Calculated concentration：${C.toFixed(2)} µM`);
    } else if (!isNaN(A) && !isNaN(C)) {
      B = (A / C) * 1000;
      document.getElementById('primerVolume').value = B.toFixed(2);
      showResult('primerResult', `Calculate the amount of water needed for re-dissolution：${B.toFixed(2)} µL`);
    } else if (!isNaN(B) && !isNaN(C)) {
      A = (C * B) / 1000;
      document.getElementById('primerAmount').value = A.toFixed(2);
      showResult('primerResult', `Calculate the required Primer yield：${A.toFixed(2)} nmole`);
    }
  }
  
  function clearPrimer() {
    ['primerAmount', 'primerVolume', 'primerConc'].forEach(id => document.getElementById(id).value = '');
    hideResult('primerResult');
  }

  // Primer稀釋計算
  function calcDilute() {
    let a = parseFloat(document.getElementById('stockConc').value);
    let b = parseFloat(document.getElementById('targetConc').value);
    let c = parseFloat(document.getElementById('targetVol').value);
    if ([a, b, c].some(v => isNaN(v) || v <= 0)) {
      showResult('diluteResult', 'Please enter all fields and the values must be greater than 0');
      return;
    }
    let d = (b / a) * c;
    let e = c - d;
    showResult('diluteResult', `Stock solution volume：${d.toFixed(2)} µL\nWater volume：${e.toFixed(2)} µL`);
  }
  
  function clearDilute() {
    ['stockConc', 'targetConc', 'targetVol'].forEach(id => document.getElementById(id).value = '');
    hideResult('diluteResult');
  }

  // 白血球計數計算
  function calculateWBC() {
    const count = parseFloat(document.getElementById('wbcCount').value);
    const squares = parseFloat(document.getElementById('wbcSquares').value);
    const dilution = parseFloat(document.getElementById('wbcDilution').value);
    const unit = parseFloat(document.getElementById('wbcUnit').value);

    if (isNaN(count) || isNaN(squares) || isNaN(dilution) || squares === 0) {
      alert('Please fill in all required fields and the number of fields cannot be 0');
      return;
    }

    // 取得單位字串
    const unitText = document.getElementById("wbcUnit").selectedOptions[0].text;

    // 計算公式：(A*C)/(B*0.1)
    const result = (count * dilution) / (squares * 0.1) * unit;
    const sciNotation = result.toExponential(2);
    const sciParts = sciNotation.split('e');
    const sciDisplay = `${Number(sciParts[0])} × 10<sup>${Number(sciParts[1])}</sup>`;

    // 顯示結果並加上單位
    document.getElementById("wbcResult").innerHTML =
      `Calculation results：${result.toFixed(2)} ${unitText}<br>Scientific notation：${sciDisplay} ${unitText}`;
    document.getElementById("wbcResult").style.display = 'block';
  }

  function updateWBCResult() {
    if (document.getElementById('wbcCount').value && document.getElementById('wbcSquares').value && document.getElementById('wbcDilution').value) {
      calculateWBC();
    }
  }

  function clearWBC() {
    document.getElementById('wbcCount').value = '';
    document.getElementById('wbcSquares').value = '';
    document.getElementById('wbcDilution').value = '';
    hideResult('wbcResult');
  }

  // 紅血球計數計算
  function calculateRBC() {
    const count = parseFloat(document.getElementById('rbcCount').value);
    const squares = parseFloat(document.getElementById('rbcSquares').value);
    const dilution = parseFloat(document.getElementById('rbcDilution').value);
    const unit = parseFloat(document.getElementById('rbcUnit').value);

    if (isNaN(count) || isNaN(squares) || isNaN(dilution) || squares === 0) {
      alert('Please fill in all required fields and the number of fields cannot be 0');
      return;
    }

    // 取得單位字串
    const unitText = document.getElementById("rbcUnit").selectedOptions[0].text;

    // 計算公式：(a*c)/(b*0.04*0.1)
    const result = (count * dilution) / (squares * 0.04 * 0.1) * unit;
    const sciNotation = result.toExponential(2);
    const sciParts = sciNotation.split('e');
    const sciDisplay = `${Number(sciParts[0])} × 10<sup>${Number(sciParts[1])}</sup>`;

    // 顯示結果並加上單位
    document.getElementById("rbcResult").innerHTML =
      `Calculation results：${result.toFixed(2)} ${unitText}<br>Scientific notation：${sciDisplay} ${unitText}`;
    document.getElementById("rbcResult").style.display = 'block';
  }

  function updateRBCResult() {
    if (document.getElementById('rbcCount').value && document.getElementById('rbcSquares').value && document.getElementById('rbcDilution').value) {
      calculateRBC();
    }
  }

  function clearRBC() {
    document.getElementById('rbcCount').value = '';
    document.getElementById('rbcSquares').value = '';
    document.getElementById('rbcDilution').value = '';
    hideResult('rbcResult');
  }

  function getSelectedText(id) {
    const sel = document.getElementById(id);
    return sel.options[sel.selectedIndex].text;
  }

  // 計時器功能
  const countdowns = Array(2).fill().map(() => ({
    interval: null,
    running: false,
    remaining: 0,
    title: '',
    audioLoopInterval: null,
    audioTimeout: null
  }));
  
  const stopwatches = Array(2).fill().map(() => ({
    interval: null,
    running: false,
    elapsed: 0,
    lastStart: 0,
    title: ''
  }));

  function updateTimerTitle(type, idx, val) {
    if(type === 'countdown') {
      countdowns[idx].title = val;
    } else {
      stopwatches[idx].title = val;
    }
  }

  function startCountdown(idx) {
    if (countdowns[idx].running) return;

    if (countdowns[idx].remaining === 0) {
      const h = parseInt(document.getElementById(`cd-hours${idx + 1}`).value) || 0;
      const m = parseInt(document.getElementById(`cd-minutes${idx + 1}`).value) || 0;
      const s = parseInt(document.getElementById(`cd-seconds${idx + 1}`).value) || 0;
      countdowns[idx].remaining = h * 3600 + m * 60 + s;
    }
    if (countdowns[idx].remaining <= 0) return;

    countdowns[idx].running = true;
    countdowns[idx].startTimestamp = Date.now();
    countdowns[idx].targetTimestamp = Date.now() + countdowns[idx].remaining * 1000;

    countdowns[idx].interval = setInterval(() => {
      const now = Date.now();
      let left = Math.round((countdowns[idx].targetTimestamp - now) / 1000);
      countdowns[idx].remaining = Math.max(0, left);
      updateCountdownDisplay(idx);
      if (countdowns[idx].remaining <= 0) {
        clearInterval(countdowns[idx].interval);
        countdowns[idx].running = false;

        // 播放鈴聲持續 30 秒
        const audio = document.getElementById('timer-audio');
        if (audio) {
          audio.currentTime = 0;
          audio.play();

          countdowns[idx].audioLoopInterval = setInterval(() => {
            audio.currentTime = 0;
            audio.play();
          }, 1250);

          countdowns[idx].audioTimeout = setTimeout(() => {
            clearInterval(countdowns[idx].audioLoopInterval);
            countdowns[idx].audioLoopInterval = null;
          }, 30000);
        }
      }
    }, 200);
    updateCountdownDisplay(idx);
  }

  function pauseCountdown(idx) {
    if (countdowns[idx].interval) clearInterval(countdowns[idx].interval);
    countdowns[idx].interval = null;
    countdowns[idx].running = false;
    // 修正剩餘秒數
    if (countdowns[idx].targetTimestamp) {
      countdowns[idx].remaining = Math.max(0, Math.round((countdowns[idx].targetTimestamp - Date.now()) / 1000));
    }
    stopAudio(idx);
  }

  function resetCountdown(idx) {
    pauseCountdown(idx);
    countdowns[idx].remaining = 0;
    document.getElementById(`cd-hours${idx + 1}`).value = '';
    document.getElementById(`cd-minutes${idx + 1}`).value = '';
    document.getElementById(`cd-seconds${idx + 1}`).value = '';
    updateCountdownDisplay(idx);
  }
  
  function stopAudio(idx) {
    if (countdowns[idx].audioLoopInterval) {
      clearInterval(countdowns[idx].audioLoopInterval);
      countdowns[idx].audioLoopInterval = null;
    }
    if (countdowns[idx].audioTimeout) {
      clearTimeout(countdowns[idx].audioTimeout);
      countdowns[idx].audioTimeout = null;
    }
    const audio = document.getElementById('timer-audio');
    if (audio) {
      audio.pause();
      audio.currentTime = 0;
    }
  }

  function updateCountdownDisplay(idx) {
    let t = countdowns[idx].remaining;
    const h = Math.floor(t / 3600);
    const m = Math.floor((t % 3600) / 60);
    const s = t % 60;
    document.getElementById(`cd-display${idx + 1}`).textContent =
      `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
  }
  
  function startStopwatch(idx) {
    if (stopwatches[idx].running) return;
    stopwatches[idx].running = true;
    stopwatches[idx].lastStart = Date.now();
    stopwatches[idx].interval = setInterval(() => {
      updateStopwatchDisplay(idx);
    }, 100);
  }
  
  function pauseStopwatch(idx) {
    if (stopwatches[idx].running) {
      stopwatches[idx].elapsed += Date.now() - stopwatches[idx].lastStart;
      stopwatches[idx].running = false;
      clearInterval(stopwatches[idx].interval);
      stopwatches[idx].interval = null;
      updateStopwatchDisplay(idx);
    }
  }
  
  function resetStopwatch(idx) {
    pauseStopwatch(idx);
    stopwatches[idx].elapsed = 0;
    updateStopwatchDisplay(idx);
  }
  
  function updateStopwatchDisplay(idx) {
    let elapsed = stopwatches[idx].elapsed;
    if (stopwatches[idx].running) {
      elapsed += Date.now() - stopwatches[idx].lastStart;
    }
    elapsed = Math.max(0, elapsed);
    const totalSeconds = Math.floor(elapsed / 1000);
    const h = Math.floor(totalSeconds / 3600);
    const m = Math.floor((totalSeconds % 3600) / 60);
    const s = totalSeconds % 60;
    const ms = Math.floor((elapsed % 1000) / 100);
    document.getElementById(`sw-display${idx+1}`).textContent =
      `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}.${ms}`;
  }

  // 初始化計時器顯示
  for(let i=0; i<2; i++) {
    updateCountdownDisplay(i);
    updateStopwatchDisplay(i);
  }
</script>
</body>
</html>